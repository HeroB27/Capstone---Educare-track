================================================================================
EDUCARE TRACK - PHASE 9 PRODUCTION STABILIZATION PROMPT
================================================================================

MODE: PRODUCTION STABILIZATION (Capstone Level)

================================================================================
ABSOLUTE RULES (NON-NEGOTIABLE)
================================================================================

1. DO NOT add new features
2. DO NOT modify business logic
3. DO NOT invent new tables or fields
4. DO NOT change UI flows
5. ONLY stabilize, optimize, and harden existing features
6. ALWAYS check the database schema before coding
7. If something breaks â†’ fix it using existing structure

================================================================================
CRITICAL REQUIREMENTS (MUST FOLLOW)
================================================================================

SCHOOL NAME: "Educare Colleges Inc"
- MUST BE FIXED CONSTANT in core/config.js
- NOT EDITABLE in admin settings
- NOT stored in database system_settings
- Display-only everywhere

STUDENT ID FORMAT (STRICT):
  EDU-YYYY-LAST4LRN-XXXX
  
  Where:
  - EDU: Fixed prefix
  - YYYY: 4-digit year
  - LAST4LRN: Last 4 characters of LRN
  - XXXX: 4-digit sequence number

QR CODE RULES:
- Single jsQR implementation shared across all roles
- Reference: core/qr-camera.js
- Validation: core/scan-actions.js
- Debounce: 2000ms (prevent duplicate scans)
- Format: EDU-YYYY-LAST4LRN-XXXX

SCANNER ROLES (MUST use same logic):
- Teacher (Gatekeeper): teacher/teacher-gatekeeper-scanner.js
- Guard: guard/guard-scanner.js
- Clinic: clinic/clinic-scanner.js

ATTENDANCE LOGIC:
- No duplicate scans per session
- Tap-in/tap-out enforcement
- Late logic from attendance_rules table
- Homeroom and subject attendance separate

CLINIC LOGIC:
- Entry/exit logging mandatory
- No stuck in_clinic state
- Teacher notification on entry
- Parent notification on entry

================================================================================
ROLE-BASED ACCESS (RLS)
================================================================================

Admin: Full access
Teacher: Assigned classes/students only
Parent: Own children only
Guard: Scan operations only
Clinic: Clinic operations only

NO ROLE LEAKAGE - verify before marking complete

================================================================================
PERFORMANCE TARGETS
================================================================================

- QR scan response: <1 second
- No blocking UI
- No console errors
- Page load: <3 seconds

================================================================================
REFERENCE FILES
================================================================================

- core/config.js - System constants (SCHOOL_NAME, STUDENT_ID_FORMAT)
- core/qr-camera.js - jsQR scanner implementation
- core/scan-actions.js - Scan validation and processing
- core/core.js - Supabase client, authentication
- core/shell.js - Dashboard shell/navigation
- supabase_migrations/ - Database schema

DASHBOARD FILES:
- admin/admin-*.html/js - Admin features
- teacher/teacher-*.html/js - Teacher features
- parent/parent-*.html/js - Parent features
- guard/guard-*.html/js - Guard features
- clinic/clinic-*.html/js - Clinic features

================================================================================
SCHEMA REFERENCE
================================================================================

Tables (DO NOT MODIFY):
- students (id TEXT PRIMARY KEY, lrn, full_name, grade_level, status)
- attendance_records (student_id, attendance_type, status, timestamp)
- clinic_visits (student_id, check_in, check_out, status)
- profiles (id, role, full_name, status)
- system_settings (key, value) - EXCEPT school_name (remove)

================================================================================
ACCEPTANCE CRITERIA
================================================================================

Phase 9 complete when:

[ ] School name is constant (not editable)
[ ] Student ID format = EDU-YYYY-LAST4LRN-XXXX
[ ] All scanners use unified jsQR logic
[ ] All dashboards fully functional
[ ] No role data leakage
[ ] No console errors
[ ] Performance targets met
[ ] System matches documentation

================================================================================
IF UNCERTAIN
================================================================================

1. Re-check supabase_migrations/ for schema
2. Re-check core/config.js for constants
3. Re-check core/scan-actions.js for validation
